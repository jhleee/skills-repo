

# 🏛️ AI 바이브 코딩을 위한 Plan-Execute-Review 안전 아키텍처

---

## 제0장. 근본 전제: 왜 대부분의 바이브 코딩이 실패하는가

```
AI 코딩의 실패 모드는 "코드 품질"이 아니라 "구조적 결함"에서 온다.

핵심 모순:
┌─────────────────────────────────────────────────┐
│  AI는 "부분 최적화"에 탁월하지만                    │
│  시스템은 "전체 정합성"을 요구한다                    │
│                                                 │
│  AI는 "현재 맥락"에서 최선을 다하지만                │
│  소프트웨어는 "시간축 위의 연속체"이다                │
│                                                 │
│  AI는 "그럴듯함(plausibility)"을 최대화하지만        │
│  엔지니어링은 "정확함(correctness)"을 요구한다        │
└─────────────────────────────────────────────────┘

따라서:
AI의 실수를 "금지"하는 것이 아니라
실수가 "전파되지 않는 구조"를 설계해야 한다.
```

### 6가지 실패 패턴

| 실패 패턴 | 설명 | 위험도 |
|-----------|------|--------|
| **맥락 증발** | 긴 세션에서 초기 제약조건을 점진적으로 잊음 | 치명적 |
| **자신감 과잉** | 불확실한 부분을 확실한 것처럼 구현 | 높음 |
| **해피 패스 편향** | 정상 흐름만 구현, 예외/경계 조건 무시 | 높음 |
| **패턴 오적용** | 학습 데이터의 패턴을 부적절한 맥락에 적용 | 중간 |
| **연쇄 붕괴** | 하나의 잘못된 가정이 후속 코드 전체를 오염 | 치명적 |
| **유령 의존성** | 존재하지 않는 API, 폐기된 문법 사용 | 중간 |

---

## 제1장. 전체 아키텍처 개관

```
                        사람의 의도
                            │
                            ▼
┌──────────────────────────────────────────────────────────────┐
│                     PLAN (계획 단계)                           │
│                                                              │
│  ┌─────────┐   ┌──────────┐   ┌──────────┐   ┌───────────┐ │
│  │ 의도    │ → │ 스펙     │ → │ 계약     │ → │ 작업      │ │
│  │ 해석    │   │ 결정화   │   │ 수립     │   │ 분해      │ │
│  └─────────┘   └──────────┘   └──────────┘   └───────────┘ │
│                                                    │         │
│                         ◄── 사람 승인 게이트 ──►     │         │
├──────────────────────────────────────────────────────────────┤
│                    EXECUTE (실행 단계)                │         │
│                                                    ▼         │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  단위 작업 루프 (Unit Task Loop)                         │ │
│  │  ┌────────┐  ┌────────┐  ┌────────┐  ┌──────────────┐ │ │
│  │  │ 검증   │→ │ 생성   │→ │ 자가   │→ │ 자동         │ │ │
│  │  │ 먼저   │  │ 최소   │  │ 비판   │  │ 게이트 통과? │ │ │
│  │  └────────┘  └────────┘  └────────┘  └──────┬───────┘ │ │
│  │       ▲                                     │ NO → 재시도│ │
│  │       └──────────────── ◄───────────────────┘ (최대3회) │ │
│  └─────────────────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────────────────┤
│                    REVIEW (검증 단계)                          │
│                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────────┐  │
│  │ 교차     │→ │ 회귀     │→ │ 의미     │→ │ 승인 or    │  │
│  │ 검증     │  │ 탐지     │  │ 일관성   │  │ 거부       │  │
│  └──────────┘  └──────────┘  └──────────┘  └────────────┘  │
│                                                              │
│                   ◄── 사람 개입: 예외 시에만 ──►               │
└──────────────────────────────────────────────────────────────┘
                            │
                            ▼
                    안전한 코드 산출물
```

---

## 제2장. PLAN (계획 단계) — 깊은 설계

### 2.1 의도 해석 (Intent Crystallization)

```
사람이 말하는 것         →    AI가 이해해야 하는 것
─────────────────────────────────────────────────
"로그인 기능 만들어"      →    이것만으로는 불충분.
                              AI는 "구현"이 아니라 "질문"을 먼저 해야 한다.
```

**의도 해석의 5가지 차원:**

```
┌──────────────────────────────────────────────────────┐
│                  의도 해석 프레임워크                    │
│                                                      │
│  1. WHAT (기능적 요구)                                 │
│     • 시스템이 "해야 하는 것"은 무엇인가?               │
│     • 입력과 출력의 형태는?                             │
│     • 성공 조건은 무엇인가?                             │
│                                                      │
│  2. WHAT NOT (부정적 요구)                             │
│     • 시스템이 "절대 하면 안 되는 것"은?                 │
│     • 어떤 데이터에 접근하면 안 되는가?                  │
│     • 어떤 부작용이 발생하면 안 되는가?                  │
│                                                      │
│  3. BOUNDARY (경계 조건)                               │
│     • 입력의 최소/최대 범위는?                          │
│     • 동시 사용자 수는?                                │
│     • 데이터가 없거나 비정상일 때 어떻게?                │
│                                                      │
│  4. CONTEXT (맥락적 제약)                              │
│     • 기존 시스템의 어떤 부분과 상호작용하는가?           │
│     • 기존 코드에서 절대 변경하면 안 되는 부분은?         │
│     • 사용 중인 패턴/관례(convention)는?                 │
│                                                      │
│  5. FAILURE (실패 시나리오)                             │
│     • 네트워크 장애 시?                                │
│     • 데이터 정합성 깨질 시?                            │
│     • 타임아웃 시?                                     │
│                                                      │
│  ➜ AI는 이 5가지를 자기 스스로 점검하고,                 │
│    불분명한 항목은 반드시 사람에게 질문해야 한다.          │
└──────────────────────────────────────────────────────┘
```

**핵심 규칙:** AI가 가정(assumption)을 할 때마다 그것을 명시적으로 선언하게 한다. 묵시적 가정이야말로 바이브 코딩 실패의 최대 원인이다.

### 2.2 스펙 결정화 (Specification Crystallization)

자연어 요구사항을 **형식적 스펙(Formal Specification)**으로 변환하는 과정.

```
사람의 자연어 요구사항
        │
        ▼
┌─────────────────────────────────────┐
│       스펙 결정화 계층 구조            │
│                                     │
│  Level 1: 서사적 스펙 (Narrative)     │
│  ─────────────────────────────      │
│  "사용자가 이메일과 비밀번호로         │
│   로그인할 수 있어야 한다"             │
│           │                         │
│           ▼                         │
│  Level 2: 구조적 스펙 (Structural)    │
│  ─────────────────────────────      │
│  • 엔드포인트: POST /auth/login      │
│  • 입력: {email: string, pw: string} │
│  • 출력: {token: string, exp: int}   │
│  • 에러: 401, 422, 429              │
│           │                         │
│           ▼                         │
│  Level 3: 계약적 스펙 (Contractual)   │
│  ─────────────────────────────      │
│  • 입력 제약: email은 RFC5322 준수    │
│  • 비밀번호: 최소 8자, 해싱 필수      │
│  • 토큰: JWT, 만료 1시간             │
│  • 속도 제한: IP당 분당 5회           │
│  • 실패 시: 구체적 에러 코드 반환     │
│           │                         │
│           ▼                         │
│  Level 4: 검증 기준 (Acceptance)      │
│  ─────────────────────────────      │
│  • Given-When-Then 시나리오 목록      │
│  • 엣지 케이스 체크리스트              │
│  • 성능 기준                         │
│  • 보안 체크리스트                    │
└─────────────────────────────────────┘

AI는 Level 1을 받으면 Level 4까지 스스로 확장하고,
사람은 Level 4의 검증 기준만 검토하면 된다.
→ 사람의 인지 부하를 "생성"에서 "판단"으로 전환
```

### 2.3 계약 수립 (Contract Establishment)

```
┌───────────────────────────────────────────────────────┐
│                   3중 계약 체계                         │
│                                                       │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 1. 데이터 계약 (Data Contract)                    │  │
│  │                                                 │  │
│  │ • 모든 외부 경계의 입출력 데이터 형태를 정의        │  │
│  │ • 스키마 언어로 표현 (JSON Schema, Protocol       │  │
│  │   Buffers, 또는 언어 자체의 타입 시스템)            │  │
│  │ • AI가 생성하는 코드는 이 계약을 위반할 수 없음      │  │
│  │ • 계약 변경은 사람만 가능                          │  │
│  └─────────────────────────────────────────────────┘  │
│                                                       │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 2. 행위 계약 (Behavioral Contract)                │  │
│  │                                                 │  │
│  │ • 사전 조건(Precondition): 함수 호출 전 참이어야   │  │
│  │   하는 것                                        │  │
│  │ • 사후 조건(Postcondition): 함수 실행 후 참이어야  │  │
│  │   하는 것                                        │  │
│  │ • 불변 조건(Invariant): 항상 참이어야 하는 것       │  │
│  │                                                 │  │
│  │ 예: "잔액 이체 후, 두 계좌의 합은 이체 전과 같다"   │  │
│  └─────────────────────────────────────────────────┘  │
│                                                       │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 3. 상호작용 계약 (Interaction Contract)            │  │
│  │                                                 │  │
│  │ • 모듈 간 호출 순서와 의존성                       │  │
│  │ • 허용된 부작용(side effect) 목록                  │  │
│  │ • 금지된 의존 방향 (계층 위반 방지)                │  │
│  │                                                 │  │
│  │ 예: "표현 계층은 데이터 접근 계층을 직접             │  │
│  │      호출할 수 없다"                              │  │
│  └─────────────────────────────────────────────────┘  │
│                                                       │
│  이 3중 계약은 "변경 불가 영역(Immutable Zone)"에 속하며  │
│  AI는 오직 이 계약의 "내부"에서만 자유롭게 구현할 수 있다  │
└───────────────────────────────────────────────────────┘
```

### 2.4 작업 분해 (Task Decomposition)

```
┌───────────────────────────────────────────────────────────┐
│                    원자적 작업 분해 원칙                     │
│                                                           │
│  하나의 요구사항을 "원자적 작업(Atomic Task)" 단위로 분해     │
│                                                           │
│  원자적 작업의 조건:                                        │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ ① 단일 책임: 하나의 작업은 하나의 관심사만 다룸        │  │
│  │ ② 독립 검증 가능: 다른 작업 없이도 성공/실패 판별 가능  │  │
│  │ ③ 되돌림 가능: 실패 시 이전 상태로 완전 복원 가능       │  │
│  │ ④ 크기 제한: 변경 파일 수 ≤ 3, 변경 줄 수 ≤ 100       │  │
│  │ ⑤ 의존성 명시: 이 작업이 필요로 하는 선행 작업 명시     │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  분해 순서:                                                │
│                                                           │
│  큰 기능                                                   │
│    ├── 데이터 구조 정의 (계약)  ← 먼저                      │
│    ├── 검증 규칙 정의          ← 두 번째                    │
│    ├── 핵심 비즈니스 로직       ← 세 번째                    │
│    ├── 에러 처리               ← 네 번째                    │
│    ├── 외부 연동               ← 다섯 번째                   │
│    └── 통합 연결               ← 마지막                     │
│                                                           │
│  각 단계는 이전 단계의 검증이 통과한 후에만 진행              │
│  → "연쇄 붕괴" 패턴 차단                                   │
└───────────────────────────────────────────────────────────┘
```

### 2.5 PLAN 단계의 사람 승인 게이트

```
사람이 검토해야 하는 것 (최소 개입 지점):

  ✅ "AI가 내 의도를 올바르게 이해했는가?"
     → AI가 생성한 5차원 의도 해석 문서를 30초 내 검토

  ✅ "검증 기준이 충분한가?"
     → AI가 생성한 Given-When-Then 시나리오 목록 검토
     → 빠진 엣지 케이스가 있는지만 확인

  ✅ "변경 범위가 적절한가?"
     → 영향받는 파일/모듈 목록 확인
     → 예상치 못한 영역이 포함되어 있지 않은지 확인

사람이 검토하지 않아도 되는 것:
  ❌ 구현 방법 (AI 자율)
  ❌ 코드 스타일 (자동화)
  ❌ 변수명/함수명 (관례 자동 적용)
```

---

## 제3장. EXECUTE (실행 단계) — 깊은 설계

### 3.1 실행의 근본 원칙: 제한된 자율성 (Bounded Autonomy)

```
┌──────────────────────────────────────────────────────────┐
│                                                          │
│   AI에게 "자유"를 주되, 그 자유의 "울타리"를 명확히 한다     │
│                                                          │
│   ┌────────────────────────────────────────────────────┐ │
│   │              자율 영역 (AI 자유)                     │ │
│   │                                                    │ │
│   │  • 알고리즘 선택                                    │ │
│   │  • 내부 변수/함수 명명                               │ │
│   │  • 구현 패턴 선택                                    │ │
│   │  • 리팩토링 방법                                    │ │
│   │  • 최적화 전략                                      │ │
│   │                                                    │ │
│   │  ┌──────────────────────────────────────────────┐  │ │
│   │  │          금지 영역 (AI 불가)                   │  │ │
│   │  │                                              │  │ │
│   │  │  • 계약(Contract) 변경                        │  │ │
│   │  │  • 아키텍처 경계 변경                          │  │ │
│   │  │  • 의존성 방향 변경                            │  │ │
│   │  │  • 보안 관련 설정 변경                          │  │ │
│   │  │  • 데이터 스키마 변경                           │  │ │
│   │  │  • 인프라 설정 변경                            │  │ │
│   │  └──────────────────────────────────────────────┘  │ │
│   └────────────────────────────────────────────────────┘ │
│                                                          │
│   울타리 = 계약 + 타입 시스템 + 자동 검증                    │
│   울타리 안에서는 AI가 완전히 자율적으로 작업                  │
│   울타리를 넘으려 하면 자동 차단 + 사람에게 에스컬레이션       │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### 3.2 단위 작업 실행 루프 (Unit Task Execution Loop)

각 원자적 작업에 대해 다음 루프를 실행:

```
┌─────────────────────────────────────────────────────────────┐
│                    단위 작업 실행 루프                         │
│                                                             │
│  ┌──────────────────────────┐                               │
│  │ Phase A: 맥락 재확인       │                               │
│  │ ─────────────────────    │                               │
│  │                          │                               │
│  │ 매 작업 시작 시 반드시:    │  ← 맥락 증발 방지의 핵심       │
│  │                          │                               │
│  │ ① 현재 작업의 목표 재진술  │                               │
│  │ ② 적용되는 계약 목록 확인  │                               │
│  │ ③ 관련 기존 코드 읽기      │                               │
│  │ ④ 금지 사항 재확인         │                               │
│  │ ⑤ 이전 작업과의 의존성 확인│                               │
│  └──────────┬───────────────┘                               │
│             │                                               │
│             ▼                                               │
│  ┌──────────────────────────┐                               │
│  │ Phase B: 검증 기준 수립    │  ← "테스트 먼저" 원칙          │
│  │ ─────────────────────    │                               │
│  │                          │                               │
│  │ 구현 코드 전에 먼저:       │                               │
│  │                          │                               │
│  │ ① 이 작업의 성공 조건을    │                               │
│  │   검증 가능한 형태로 기술   │                               │
│  │ ② 정상 시나리오 검증 기준  │                               │
│  │ ③ 엣지 케이스 검증 기준    │                               │
│  │ ④ 에러 시나리오 검증 기준  │                               │
│  │ ⑤ 기존 기능 회귀 방지 기준 │                               │
│  └──────────┬───────────────┘                               │
│             │                                               │
│             ▼                                               │
│  ┌──────────────────────────┐                               │
│  │ Phase C: 최소 구현         │                               │
│  │ ─────────────────────    │                               │
│  │                          │                               │
│  │ ① 검증 기준을 통과하는     │                               │
│  │   최소한의 코드만 작성      │                               │
│  │ ② 과도한 추상화 금지       │                               │
│  │ ③ 미래 요구사항 선제 구현   │                               │
│  │   금지 (YAGNI)            │                               │
│  │ ④ 각 결정에 대한 근거 기록  │                               │
│  └──────────┬───────────────┘                               │
│             │                                               │
│             ▼                                               │
│  ┌──────────────────────────┐                               │
│  │ Phase D: 자가 비판         │  ← AI가 스스로를 의심          │
│  │ ─────────────────────    │                               │
│  │                          │                               │
│  │ AI가 스스로에게 질문:      │                               │
│  │                          │                               │
│  │ ① "이 코드에 버그가 있다면 │                               │
│  │    어디에 있겠는가?"       │                               │
│  │ ② "어떤 입력이 들어오면    │                               │
│  │    이 코드가 실패하는가?"   │                               │
│  │ ③ "내가 암묵적으로 가정한  │                               │
│  │    것은 무엇인가?"         │                               │
│  │ ④ "기존 코드와 충돌하는    │                               │
│  │    부분이 있는가?"         │                               │
│  │ ⑤ "확신도 1~10으로       │                               │
│  │    몇 점인가? 7 미만이면   │                               │
│  │    사람에게 에스컬레이션"   │                               │
│  └──────────┬───────────────┘                               │
│             │                                               │
│             ▼                                               │
│  ┌──────────────────────────┐                               │
│  │ Phase E: 자동 게이트       │                               │
│  │ ─────────────────────    │                               │
│  │                          │                               │
│  │ 자동화된 검증 통과 확인:   │                               │
│  │                          │                               │
│  │ ✓ 타입 검사 통과?          │                               │
│  │ ✓ 정적 분석 통과?          │                               │
│  │ ✓ 검증 기준(테스트) 통과?   │                               │
│  │ ✓ 기존 테스트 회귀 없음?    │                               │
│  │ ✓ 계약 위반 없음?          │                               │
│  │ ✓ 금지 패턴 미사용?        │                               │
│  │                          │                               │
│  │ 전부 통과 → 다음 작업으로  │                               │
│  │ 하나라도 실패 → 재시도     │                               │
│  │ 3회 재시도 실패 → 에스컬레이션│                              │
│  └──────────────────────────┘                               │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 맥락 관리 전략 (Anti-Context Evaporation)

```
┌───────────────────────────────────────────────────────────┐
│                  맥락 보존 3중 구조                         │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ 1층: 영구 맥락 (Permanent Context)                    │  │
│  │                                                     │  │
│  │ • 프로젝트의 불변 규칙                                │  │
│  │ • 아키텍처 원칙                                      │  │
│  │ • 기술 스택 제약                                     │  │
│  │ • 코딩 관례                                          │  │
│  │ • 금지 패턴 목록                                     │  │
│  │                                                     │  │
│  │ → System Prompt 또는 Rules File로 매 대화에 주입       │  │
│  │ → 절대 세션 중 소실되지 않음                           │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ 2층: 세션 맥락 (Session Context)                      │  │
│  │                                                     │  │
│  │ • 현재 작업의 전체 계획                               │  │
│  │ • 완료된 작업 목록과 결과                              │  │
│  │ • 현재 작업의 계약                                    │  │
│  │ • 누적된 가정(assumption) 목록                        │  │
│  │ • 발견된 위험 요소                                    │  │
│  │                                                     │  │
│  │ → 각 작업 시작 시 "세션 요약"으로 재주입                │  │
│  │ → 긴 세션에서도 맥락 유지                              │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ 3층: 작업 맥락 (Task Context)                         │  │
│  │                                                     │  │
│  │ • 현재 원자적 작업의 목표                              │  │
│  │ • 이 작업에 관련된 파일들의 현재 상태                   │  │
│  │ • 이 작업의 검증 기준                                 │  │
│  │ • 이 작업의 제약조건                                  │  │
│  │                                                     │  │
│  │ → 작업마다 갱신                                      │  │
│  │ → 작업 완료 시 결과를 세션 맥락으로 승급               │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  핵심: 각 층의 맥락이 명시적 문서(artifact)로 존재하여       │
│        AI의 컨텍스트 윈도우 제한과 무관하게 보존된다          │
└───────────────────────────────────────────────────────────┘
```

### 3.4 확신도 기반 에스컬레이션 (Confidence-Based Escalation)

```
┌───────────────────────────────────────────────────────────┐
│                                                           │
│   AI가 모든 결정에 대해 확신도를 자기 평가하게 한다           │
│                                                           │
│   확신도 9-10: 자율 진행                                   │
│   ──────────────────────────────────────                  │
│   • 명확한 패턴, 단순한 CRUD, 잘 알려진 관례                │
│   • 자동 게이트만 통과하면 사람 개입 불필요                  │
│                                                           │
│   확신도 6-8: 계획 보고 후 진행                             │
│   ──────────────────────────────────────                  │
│   • AI가 "이렇게 하려고 합니다"를 먼저 보고                  │
│   • 사람이 빠르게 승인/거부 (10초 내 판단 가능한 수준)        │
│                                                           │
│   확신도 3-5: 선택지 제시 후 사람 결정                      │
│   ──────────────────────────────────────                  │
│   • AI가 2~3개 대안을 각각의 장단점과 함께 제시               │
│   • 사람이 방향을 선택                                     │
│                                                           │
│   확신도 1-2: 작업 중단, 사람에게 완전 위임                  │
│   ──────────────────────────────────────                  │
│   • 도메인 지식 부족, 모호한 요구사항                        │
│   • "제가 이 부분을 정확히 이해하지 못합니다"                 │
│                                                           │
│   ★ 핵심: AI가 "모르는 것을 모른다고 말하도록" 강제하는 것    │
│     이것이 바이브 코딩 안전의 가장 중요한 단일 제약조건        │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

### 3.5 금지 패턴 체계 (Banned Pattern System)

```
┌───────────────────────────────────────────────────────────┐
│                   금지 패턴 분류 체계                       │
│                                                           │
│  🔴 Class A: 절대 금지 (자동 차단, 예외 없음)               │
│  ─────────────────────────────────────────                │
│  • 보안 자격 증명의 하드코딩                                │
│  • 사용자 입력의 무검증 사용                                │
│  • 에러의 무시적 처리 (silent catch/swallow)                │
│  • 무한 재귀/반복 가능성이 있는 구조                         │
│  • 인증/인가 로직의 우회                                    │
│  • 직접적 문자열 조합에 의한 쿼리 구성                       │
│                                                           │
│  🟡 Class B: 조건부 금지 (사람 승인 시에만 허용)             │
│  ─────────────────────────────────────────                │
│  • 새로운 외부 의존성 추가                                  │
│  • 기존 공개 인터페이스 변경                                │
│  • 데이터베이스 스키마 변경                                 │
│  • 전역 상태 접근                                          │
│  • 비동기 작업의 동기적 대기                                │
│                                                           │
│  🟢 Class C: 권장하지 않음 (자동 경고, 진행은 가능)          │
│  ─────────────────────────────────────────                │
│  • 과도한 중첩 (3단계 초과)                                 │
│  • 긴 함수 (50줄 초과)                                     │
│  • 매개변수 과다 (4개 초과)                                 │
│  • 주석 없는 복잡한 로직                                    │
│  • 매직 넘버/매직 스트링 사용                               │
│                                                           │
│  탐지 방법:                                                │
│  • 정적 분석 도구의 커스텀 규칙으로 자동 탐지                 │
│  • AI 자가 점검 단계에서 패턴 매칭                           │
│  • 코드 리뷰 AI의 교차 검증에서 탐지                        │
└───────────────────────────────────────────────────────────┘
```

---

## 제4장. REVIEW (검증 단계) — 깊은 설계

### 4.1 다층 검증 파이프라인

```
AI가 생성한 코드
       │
       ▼
┌──────────────────────────────────────────────────────────┐
│  Gate 1: 형식적 검증 (Formal Verification)                │
│  ────────────────────────────────────────                │
│                                                          │
│  • 타입 시스템에 의한 검증                                 │
│    → 타입 검사기가 통과시키지 않으면 코드가 존재할 수 없음    │
│    → 가장 강력하고 가장 저렴한 검증 수단                     │
│    → 핵심: 타입 시스템의 엄격도를 최대로 설정                │
│                                                          │
│  • 정적 분석에 의한 패턴 검증                               │
│    → 금지 패턴 자동 탐지                                   │
│    → 복잡도 메트릭 초과 탐지                                │
│    → 보안 취약 패턴 탐지                                   │
│                                                          │
│  비용: 거의 0 (밀리초 단위, 완전 자동)                       │
│  차단율: AI 실수의 약 40%                                  │
└──────────────────┬───────────────────────────────────────┘
                   │ 통과
                   ▼
┌──────────────────────────────────────────────────────────┐
│  Gate 2: 계약 검증 (Contract Verification)                │
│  ────────────────────────────────────────                │
│                                                          │
│  • 데이터 계약 준수 여부                                   │
│    → 모든 입출력이 스키마와 일치하는지                       │
│    → 런타임 타입 검증 계층이 올바르게 적용되었는지            │
│                                                          │
│  • 행위 계약 준수 여부                                     │
│    → 사전/사후/불변 조건이 코드에 반영되었는지               │
│    → 선언된 부작용만 발생하는지                             │
│                                                          │
│  • 상호작용 계약 준수 여부                                  │
│    → 의존성 방향 위반 없는지                                │
│    → 계층 경계 침범 없는지                                 │
│                                                          │
│  비용: 낮음 (초 단위, 완전 자동)                             │
│  차단율: AI 실수의 추가 20%                                │
└──────────────────┬───────────────────────────────────────┘
                   │ 통과
                   ▼
┌──────────────────────────────────────────────────────────┐
│  Gate 3: 행위 검증 (Behavioral Verification)              │
│  ────────────────────────────────────────                │
│                                                          │
│  • 단위 검증                                              │
│    → AI가 생성한 검증 기준(테스트)이 통과하는지              │
│    → 정상/엣지/에러 시나리오 모두 포함                      │
│                                                          │
│  • 속성 기반 검증 (Property-based Testing)                 │
│    → 무작위 입력에 대해 불변 속성이 유지되는지              │
│    → AI가 예상하지 못한 입력 조합 탐색                      │
│    → 예: "어떤 순서로 호출하든 데이터 정합성 유지"           │
│                                                          │
│  • 회귀 검증                                              │
│    → 기존의 모든 검증이 여전히 통과하는지                   │
│    → 검증 커버리지가 하락하지 않았는지                      │
│                                                          │
│  비용: 중간 (분 단위, 완전 자동)                            │
│  차단율: AI 실수의 추가 25%                                │
└──────────────────┬───────────────────────────────────────┘
                   │ 통과
                   ▼
┌──────────────────────────────────────────────────────────┐
│  Gate 4: 의미 검증 (Semantic Verification)                │
│  ────────────────────────────────────────                │
│                                                          │
│  • AI 교차 리뷰 (Cross-AI Review)                         │
│    → 생성한 AI와 다른 AI 모델이 코드를 리뷰                 │
│    → 동일 모델의 맹점(blind spot) 보완                     │
│    → 리뷰어 AI에게 주는 지시:                              │
│      "이 코드에서 버그, 보안 취약점,                        │
│       논리 오류, 엣지 케이스 누락만 보고하라.                │
│       칭찬이나 스타일 코멘트는 하지 마라."                   │
│                                                          │
│  • 변경 의미 분석 (Semantic Diff)                          │
│    → 단순 텍스트 차이가 아닌 "의미적 변화" 분석             │
│    → "이 변경으로 인해 시스템의 어떤 행위가 달라지는가?"     │
│    → 의도하지 않은 행위 변화 탐지                          │
│                                                          │
│  • 의도 일치성 검증                                       │
│    → 원래 요구사항과 구현 결과가 의미적으로 일치하는지       │
│    → "사용자가 원한 것"과 "AI가 만든 것" 사이의 간극 탐지   │
│                                                          │
│  비용: 중간 (AI API 호출 비용, 분 단위)                     │
│  차단율: AI 실수의 추가 10%                                │
└──────────────────┬───────────────────────────────────────┘
                   │ 통과
                   ▼
┌──────────────────────────────────────────────────────────┐
│  Gate 5: 통합 검증 (Integration Verification)             │
│  ────────────────────────────────────────                │
│                                                          │
│  • 시스템 전체 맥락에서의 검증                              │
│    → 다른 모듈과의 상호작용 정상 여부                       │
│    → 전체 워크플로우 시나리오 검증                          │
│                                                          │
│  • 성능 회귀 검증                                         │
│    → 응답 시간, 메모리 사용량 등이 허용 범위 이내인지        │
│    → 기존 대비 10% 이상 성능 저하 시 경고                   │
│                                                          │
│  • 변경 크기 검증                                         │
│    → 예상보다 큰 변경은 자동 차단                           │
│    → 변경된 파일 수, 줄 수, 의존성 변화 측정                │
│                                                          │
│  비용: 높음 (분~시간 단위, 자동)                            │
│  차단율: AI 실수의 추가 약 4%                              │
└──────────────────┬───────────────────────────────────────┘
                   │ 통과
                   ▼
            ┌──────────────┐
            │ 자동 승인 ✅  │
            │ 사람 개입 없음 │
            └──────────────┘

  ※ 어떤 Gate에서든 실패 시:
     → 재시도(최대 3회) → 실패 지속 시 사람에게 에스컬레이션
     → 사람은 "왜 실패했는지"만 판단하면 됨
     
  총 자동 차단율: ~99% (사람이 볼 필요 있는 건 ~1%)
```

### 4.2 교차 검증 심화: 적대적 리뷰 (Adversarial Review)

```
┌───────────────────────────────────────────────────────────┐
│                                                           │
│  일반 리뷰: "이 코드에 문제가 있나요?"                       │
│  적대적 리뷰: "이 코드를 어떻게 하면 깨뜨릴 수 있나요?"       │
│                                                           │
│  적대적 리뷰어 AI에게 주는 역할:                             │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ 역할 1: 악의적 사용자 (Malicious User)                │  │
│  │                                                     │  │
│  │ "당신은 이 시스템을 악용하려는 공격자입니다.            │  │
│  │  이 코드 변경을 보고, 악용할 수 있는 지점을             │  │
│  │  찾으세요. 특히 입력 조작, 권한 우회,                  │  │
│  │  데이터 유출 가능성에 집중하세요."                      │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ 역할 2: 머피의 법칙 화신 (Murphy's Advocate)          │  │
│  │                                                     │  │
│  │ "모든 것이 최악으로 잘못될 수 있다고 가정하세요.         │  │
│  │  네트워크가 중간에 끊기면? 디스크가 가득 차면?          │  │
│  │  동시에 1000명이 같은 요청을 보내면?                   │  │
│  │  입력이 10MB짜리 문자열이면?                           │  │
│  │  시간대가 다른 서버에서 실행되면?"                      │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ 역할 3: 미래의 유지보수자 (Future Maintainer)          │  │
│  │                                                     │  │
│  │ "당신은 6개월 후 이 코드를 처음 보는 개발자입니다.       │  │
│  │  이 코드를 이해할 수 있나요? 수정하려면                 │  │
│  │  어디를 건드려야 하나요? 실수로 다른 것을               │  │
│  │  깨뜨릴 위험은 없나요?"                               │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                           │
│  3가지 역할 중 하나라도 심각한 문제를 발견하면               │
│  → 자동 차단 + 구체적 문제점을 생성 AI에게 피드백           │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

### 4.3 회귀 방지 체계

```
┌───────────────────────────────────────────────────────────┐
│                   회귀의 3가지 유형과 대응                    │
│                                                           │
│  Type 1: 기능 회귀 (Functional Regression)                 │
│  ──────────────────────────────────────                   │
│  "되던 것이 안 되게 됨"                                     │
│                                                           │
│  대응: 기존 검증 스위트 전체 실행                             │
│  → 하나라도 실패하면 무조건 차단                             │
│  → 새 기능 추가 시 기존 검증은 절대 삭제/수정 불가            │
│  → AI에게 "기존 테스트를 고치지 마라, 코드를 고쳐라" 지시     │
│                                                           │
│                                                           │
│  Type 2: 성능 회귀 (Performance Regression)                │
│  ──────────────────────────────────────                   │
│  "느려지거나 자원을 더 소모하게 됨"                           │
│                                                           │
│  대응: 성능 기준선(baseline)과 비교                          │
│  → 응답 시간, 메모리, CPU 사용률 측정                        │
│  → 기준선 대비 N% 이상 악화 시 경고/차단                     │
│  → AI는 "빅오 복잡도가 악화되는" 변경을 할 때 명시적 보고     │
│                                                           │
│                                                           │
│  Type 3: 의미 회귀 (Semantic Regression)                   │
│  ──────────────────────────────────────                   │
│  "테스트는 통과하지만 의미가 달라짐"                          │
│  (가장 위험하고 탐지가 어려움)                                │
│                                                           │
│  대응:                                                     │
│  → 계약(Contract)에 의한 의미 고정                          │
│  → AI 교차 리뷰에서 "의미 변화" 탐지                         │
│  → 속성 기반 검증으로 불변 속성 확인                         │
│  → 변경 전후의 "행위 프로파일" 비교                          │
│    (동일 입력 → 동일 출력 보장)                              │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

---

## 제5장. 메타 구조: 전체를 관통하는 원칙

### 5.1 신뢰 영역 모델 (Trust Zone Model)

```
┌───────────────────────────────────────────────────────────┐
│                                                           │
│   모든 코드 영역을 신뢰 수준에 따라 분류                      │
│                                                           │
│   ┌─────────────────────────────────────────────────┐     │
│   │                                                 │     │
│   │  Zone 0: 성역 (Sanctuary)                       │     │
│   │  ─────────────────────                          │     │
│   │  AI 접근 완전 차단                               │     │
│   │                                                 │     │
│   │  • 보안 설정, 암호화 로직                         │     │
│   │  • 인증/인가 핵심 로직                            │     │
│   │  • 과금/결제 핵심 로직                            │     │
│   │  • 인프라 설정 (배포, 네트워크, 데이터베이스 설정)  │     │
│   │  • 계약 정의 파일                                │     │
│   │                                                 │     │
│   │  ┌─────────────────────────────────────────┐    │     │
│   │  │                                         │    │     │
│   │  │  Zone 1: 감시 구역 (Supervised Zone)     │    │     │
│   │  │  ─────────────────────                  │    │     │
│   │  │  AI 생성 가능, 사람 승인 필수             │    │     │
│   │  │                                         │    │     │
│   │  │  • 핵심 비즈니스 로직                     │    │     │
│   │  │  • 데이터 변환/가공 로직                   │    │     │
│   │  │  • 외부 시스템 연동 로직                   │    │     │
│   │  │  • 에러 처리 정책                         │    │     │
│   │  │                                         │    │     │
│   │  │  ┌─────────────────────────────────┐    │    │     │
│   │  │  │                                 │    │    │     │
│   │  │  │  Zone 2: 자율 구역               │    │    │     │
│   │  │  │  (Autonomous Zone)              │    │    │     │
│   │  │  │  ─────────────────              │    │    │     │
│   │  │  │  AI 완전 자율,                   │    │    │     │
│   │  │  │  자동 게이트만 통과하면 됨         │    │    │     │
│   │  │  │                                 │    │    │     │
│   │  │  │  • 표현 계층 (UI 컴포넌트)        │    │    │     │
│   │  │  │  • 유틸리티 함수                  │    │    │     │
│   │  │  │  • 단위 검증 코드                 │    │    │     │
│   │  │  │  • 문서/주석                     │    │    │     │
│   │  │  │  • 설정/환경 파일 (비보안)         │    │    │     │
│   │  │  │                                 │    │    │     │
│   │  │  └─────────────────────────────────┘    │    │     │
│   │  └─────────────────────────────────────────┘    │     │
│   └─────────────────────────────────────────────────┘     │
│                                                           │
│   효과:                                                    │
│   • Zone 2는 전체 코드의 약 60-70%                         │
│   • 사람은 Zone 1 (20-30%)만 검토하면 됨                    │
│   • Zone 0 (5-10%)는 사람이 직접 작성                      │
│   → 사람 개입을 70% 이상 줄이면서 안전성 확보                │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

### 5.2 실패 격리 아키텍처 (Failure Isolation)

```
┌───────────────────────────────────────────────────────────┐
│                                                           │
│  전제: AI의 실수는 반드시 발생한다.                           │
│  목표: 실수의 "폭발 반경(blast radius)"을 최소화한다.        │
│                                                           │
│  원칙 1: 경계 검증 (Boundary Validation)                    │
│  ─────────────────────────────────────                    │
│  모든 모듈의 입구와 출구에 검증 장벽을 둔다.                  │
│  AI가 모듈 내부에서 실수해도, 잘못된 데이터가                 │
│  모듈 밖으로 전파되지 않는다.                                │
│                                                           │
│     모듈A        경계검증        모듈B        경계검증       │
│  ┌─────────┐   ┌──────┐   ┌─────────┐   ┌──────┐        │
│  │ AI 코드  │──▶│ 검증 │──▶│ AI 코드  │──▶│ 검증 │──▶ ... │
│  │ (자유)   │   │ 장벽 │   │ (자유)   │   │ 장벽 │        │
│  └─────────┘   └──┬───┘   └─────────┘   └──┬───┘        │
│                   │위반 시                    │위반 시      │
│                   ▼                          ▼            │
│               차단 + 알림                차단 + 알림       │
│                                                           │
│                                                           │
│  원칙 2: 불변 조건의 지속적 감시                             │
│  ─────────────────────────────────────                    │
│  비즈니스적으로 절대 위반되면 안 되는 조건을 식별하고          │
│  코드 전체에 걸쳐 지속적으로 확인한다.                        │
│                                                           │
│  예시:                                                     │
│  • "사용자 잔액은 음수가 될 수 없다"                         │
│  • "주문 상태는 정해진 상태 전이만 가능하다"                  │
│  • "삭제된 데이터는 복구 가능해야 한다"                       │
│                                                           │
│  이 불변 조건이 위반되면:                                    │
│  → 즉시 작업 중단                                          │
│  → 트랜잭션 롤백                                           │
│  → 사람에게 즉시 알림                                       │
│                                                           │
│                                                           │
│  원칙 3: 점진적 배포와 자동 롤백                             │
│  ─────────────────────────────────────                    │
│  AI 생성 코드를 한꺼번에 배포하지 않는다.                     │
│                                                           │
│  1% 트래픽 → 모니터링 → 이상 없음 → 10% → ... → 100%       │
│                          │                                │
│                     이상 발견 시                             │
│                          │                                │
│                          ▼                                │
│                   자동 즉시 롤백                             │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

### 5.3 피드백 루프 (Continuous Learning Loop)

```
┌───────────────────────────────────────────────────────────┐
│                    적응적 제약 시스템                        │
│                                                           │
│  AI의 실수 패턴을 수집하고, 제약조건을 자동으로 진화시킨다     │
│                                                           │
│       실수 발생                                            │
│          │                                                │
│          ▼                                                │
│   ┌──────────────┐                                        │
│   │ 원인 분류     │                                        │
│   │              │                                        │
│   │ • 맥락 누락?  │                                        │
│   │ • 패턴 오적용? │                                        │
│   │ • 스펙 모호?   │                                        │
│   │ • 계약 부재?   │                                        │
│   │ • 검증 부족?   │                                        │
│   └──────┬───────┘                                        │
│          │                                                │
│          ▼                                                │
│   ┌──────────────────┐                                    │
│   │ 제약 조건 갱신     │                                    │
│   │                  │                                    │
│   │ • 새 금지 패턴 추가 │                                   │
│   │ • 검증 규칙 강화    │                                   │
│   │ • 맥락 문서 보강    │                                   │
│   │ • 계약 상세화       │                                   │
│   └──────┬───────────┘                                    │
│          │                                                │
│          ▼                                                │
│   ┌──────────────────┐                                    │
│   │ 회고 기록 축적     │                                    │
│   │                  │                                    │
│   │ "이 프로젝트에서    │                                   │
│   │  AI는 X 유형의     │                                    │
│   │  실수를 자주 한다.  │                                   │
│   │  따라서 Y를        │                                    │
│   │  항상 확인하라."    │                                   │
│   └──────────────────┘                                    │
│                                                           │
│   → 이 회고 기록이 영구 맥락(Permanent Context)에 추가됨     │
│   → 같은 실수가 반복되지 않는 자기 강화 시스템                │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

---

## 제6장. 사람 개입 최소화 매트릭스

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  활동                    │ AI 자율 │ AI+자동검증 │ 사람 필요      │
│  ────────────────────────┼────────┼───────────┼──────────      │
│  의도 해석               │        │           │  ✅ 승인        │
│  스펙 결정화             │  ✅    │           │  ✅ 검토(30초)  │
│  계약 정의               │        │           │  ✅ 결정        │
│  작업 분해               │  ✅    │           │                │
│  검증 기준 작성           │  ✅    │           │  ✅ 검토(1분)   │
│  구현 코드 생성           │  ✅    │           │                │
│  자가 비판               │  ✅    │           │                │
│  타입/정적 분석           │        │  ✅       │                │
│  계약 준수 검증           │        │  ✅       │                │
│  테스트 실행             │        │  ✅       │                │
│  교차 AI 리뷰            │        │  ✅       │                │
│  회귀 검증               │        │  ✅       │                │
│  성능 검증               │        │  ✅       │                │
│  배포                    │        │  ✅       │                │
│  모니터링/롤백            │        │  ✅       │                │
│  ────────────────────────┼────────┼───────────┼──────────      │
│  사람 개입 포인트: 3곳 (의도 승인, 스펙 검토, 검증기준 검토)    │
│  예상 소요 시간: 기능당 약 2~5분                                │
│  나머지 전부 자동화                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 제7장. 최종 요약: 10가지 불변 원칙

```
┌───────────────────────────────────────────────────────────┐
│                                                           │
│  ① AI의 실수를 금지하지 말고, 실수의 전파를 차단하라          │
│                                                           │
│  ② 사람은 "무엇을(What)" 결정하고,                          │
│     AI는 "어떻게(How)" 실행하되,                            │
│     기계가 "맞는지(Correct)" 검증한다                       │
│                                                           │
│  ③ 계약(Contract)이 코드보다 먼저 존재하고,                  │
│     코드보다 오래 살아남아야 한다                             │
│                                                           │
│  ④ AI가 가정할 때는 반드시 명시적으로 선언하게 하라            │
│     묵시적 가정이 가장 위험한 버그의 원천이다                  │
│                                                           │
│  ⑤ 자신감이 아니라 검증으로 신뢰를 구축하라                   │
│     AI가 "확실합니다"라고 해도 자동 검증을 우회하지 마라       │
│                                                           │
│  ⑥ 맥락은 자연 소멸한다.                                    │
│     모든 중요한 맥락을 명시적 문서로 외재화하라                │
│                                                           │
│  ⑦ 작을수록 안전하다.                                       │
│     작은 변경, 작은 함수, 작은 모듈, 작은 배포 단위            │
│                                                           │
│  ⑧ 동일 AI의 생성과 검증은 같은 맹점을 공유한다.              │
│     반드시 다른 관점(다른 모델, 다른 역할)으로 교차 검증하라   │
│                                                           │
│  ⑨ 실패를 전제하고 설계하라.                                 │
│     롤백 불가능한 변경을 AI에게 허용하지 마라                  │
│                                                           │
│  ⑩ 제약조건을 진화시켜라.                                    │
│     어제의 실수가 오늘의 규칙이 되고,                         │
│     오늘의 규칙이 내일의 자동화가 된다                        │
│                                                           │
└───────────────────────────────────────────────────────────┘
```
